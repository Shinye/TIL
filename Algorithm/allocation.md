# 정적할당과 동적할당



## 정적할당

정적할당은 일반적으로 우리가 하는 변수 선언이다.

변수나 함수, 배열 등을 선언함으로써 메모리에 할당할 때, 메모리에게 미리 그 크기를 알려주어 메모리 공간의 필요량을 알려주는 방법이다.

```c++
int main(){
  int num1; // int자료형이니 4바이트만큼의 메모리 할당
  double num2; // double자료형이니 8바이트만큼의 메모리 할당
  int array[10]; // 4*10바이트 메모리 할당
}
```



## 동적할당

프로그램이 실행 도중에 동적으로 메모리를 할당받는 것을 말한다. <br>동적할당에 대한 본격적인 설명에 앞서 메모리에 관하여 짚고 넘어가면 이해가 빠르다.

> 정작 동적할당 얘기는 한참 뒤에나 나오는…쿨럭;;

<br>

### 메모리

메모리 계층 구조에는 크게 네 가지 종류가 있고 다음과 같은 특성을 가지고 있다.

* **레지스터** <br>CPU 내부 메모리. 작지만 엄청 빠른 속도로 동작하는 초고속 경량 메모리

* **캐시** <br>프로그램 소스들 중 자주 쓰이는 것들을 모아두는 곳<br>예를 들어,

  ```c++
  int main(){
    int n=0;
    for(int m=0; m<20000; m++){ 
      n++;
    }
    cout << n << endl;
  }
  ```

  위의 코드 예제의 경우, for문을 캐시에 넣을 수 있다. int n선언이나 cout 등 다른 코드들은 한 번만 실행되면 되지만 for문 코드는 2만번이 실행되기 때문이다.

* **RAM(메인 메모리)** <br>하드디스크에 저장되어 있는 실행프로그램을 램으로 이동시켜 실행하게 된다(작업관리자에 뜨는 실행중인 프로그램 목록들은 RAM에 위치하고 있다.)

* **하드디스크**<br> 파일I/O 담당(맞는지 확인 후 수정하기!!!!)



여기서 잠깐, 메모리는 왜 굳이 네 개 씩이나 분할되어 필요한걸까?

이론상으로는 하드디스크 단 하나와 CPU(캐시와 레지스터가 없는) 만으로도 동작에는 문제가 없다. 하드디스크는 대체로 용량이 아주 크기 때문에 하드디스크에 데이터들을 담아도 큰 문제는 없다. 다만 하드 디스크는 정말! 느리다. 따라서 속도 및 성능의 문제 때문에 하드디스크보다 더 빠른 메모리인 RAM을 CPU와 하드디스크 사이에 추가한 것이다.



![](https://68.media.tumblr.com/e567d844da8e068cc667cdd0b507872c/tumblr_old0w4hcNA1v80c66o1_1280.png)

> (물론 CPU에는 해당 요소들 뿐만 아니라 컨트롤유닛 버스인터페이스 와 같은 다른 요소들도 포함되어 있지만 주제상 표기하지는 않았습니다.)

여기서 ALU는 Arithmetic(산술,연산) Logic Unit의 약자로 실제로 CPU 안에서 연산을 담당하는 장치이다.

CPU 안에 메모리가 필요한 이유는 ALU의 빠른 연산을 돕기 위해서이다. RAM에서 필요한 데이터들을 레지스터 안으로 가져와 저장하고, ALU는 레지스터에 저장된 데이터를 가져가 연산을 한다. RAM에서 그때 그때 데이터를 ALU로 바로 가져오는 것 보다 CPU내부의 메모리를 사용하는 것이 더 빠르다. (고속도로와 국도의 차이 같은 느낌이라고 하네요..?)



여기까지 컴퓨터 내부의 메모리에 대하여 간단하게 살펴보았다. 그렇다면 우리가 C/C++ 코딩을 할 때 쓰이는 포인터를 다룰 때 주로 말하는 '메모리의 주소값'에서의 메모리는 어떤 메모리를 말하는 것일까? 

바로 `가상메모리` 이다.



### 가상메모리

(C/C++ 기준의! 가상메모리에 대한 설명입니다.)

가상메모리란 RAM을 관리하는 방법의 하나로(RAM은 현재 실행중인 프로그램을 관리하니, 그 프로그램의 가상메모리를 할당해주는거니 RAM의 관리 방법 중 하나가 맞는것으로..추정된다…확인해볼것…), 실제 메모리(RAM, 레지스터,캐시, 하드디스크)를 하나의 구조로 보이게끔 해주는 가상의 메모리이다. 각 프로그램에 실제 메모리 주소(물리 주소)가 아닌 가상의 메모리 주소(가상주소 혹은 논리 주소)를 준다. 가상 주소의 범위를 가상 주소 공간이라고 하며, 가상 주소 공간은 `메모리 관리 장치`에 의해 물리주소로 변환된다.

프로그램을 실행하며 가상의 메모리가 필요한 이유는 다음과 같다.

- 프로그램의 실행과정에서 선언하는 변수의 메모리 공간 할당을 위해
- 프로그램의 실행과정에서 사용되는 상수의 표현을 위해
- 연산 및 호출된 함수의 반환 값을 임시로 저장하기 위해



가상메모리를 효과적으로 사용하기 위해 가상메모리는 역할에 따라 크게 네 가지로 분류된다.

![](https://68.media.tumblr.com/e333959f4d0ebe33acaa7d7d75e6be3e/tumblr_oldaoip1Pc1v80c66o1_1280.png)

- **코드 영역** : 프로그램 설계 시 작성한 함수는 모두 여기에 저장된다고 볼 수 있다. 코드 전체적인 부분을 여기에 저장해 놓는다.  코딩한 것을 실행을 시키면 CPU가 알아서 코드 영역에 저장된 명령어들을 하나씩 가져가서 처리하는 방식으로 프로그램을 실행한다.
- **데이터 영역** : 프로그램 시작과 동시에 할당 되고 프로그램이 종료될 때 까지 남아있다. 변수 초기화를 해주지 않아도 변수에 디폴트 값으로 0이 주어진다. <br>전역 변수와 static 변수는 데이터 영역에 할당됨으로써 프로그램의 첫 시작부터 종료 시점까지 생존할 수 있다는 공통점이 있지만, 전역변수의 접근 영역은 코드 전체인데 반해 static변수는 변수가 선언된 스코프 안에서만 접근영역이 제한된다는 차이점이 있다.


- **스택 영역** :  지역변수도 매개변수도 해당 함수의 스코프를 벗어나면 변수가 사라지게 된다. 또한 지역변수는 할당되는 변수값이 그때그때 바뀌곤 하기 때문에 (int n=0; n++; // 0을 할당한 n이 지워지고 1이 할당된 n이 생성됨..) 스택 영역에 할당되는 것이 맞다.
- **힙 영역** : 힙 영역은 동적으로 메모리를 할당 할 때 사용되는 변수이다. 코드가 실행되는 도중인 런타임에 메모리를 할당 동적으로 메모리를 할당하면 



### 참고URL

http://blog.daum.net/_blog/BlogTypeView.do?blogid=0Nu8o&articleno=40&categoryId=1&regdt=20090518160416<br>http://blog.naver.com/skout123/50125764985<br>http://blog.naver.com/skout123/50115353896<br>http://blog.naver.com/skout123/50127618681<br>http://blog.naver.com/skout123/50127687176<br>http://blog.naver.com/skout123/50128375008<br>http://dsnight.tistory.com/50<br>http://multithread.tistory.com/entry/C-%EA%B0%9D%EC%B2%B4%EC%83%9D%EC%84%B1-%EB%91%90%EA%B0%80%EC%A7%80-%EB%B0%A9%EB%B2%95%EA%B3%BC-%EC%9D%98%EB%AC%B8%EC%A0%90new%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%8F%99%EC%A0%81%ED%95%A0%EB%8B%B9%EA%B0%9D%EC%B2%B4<br>https://ko.wikipedia.org/wiki/%EB%A9%94%EB%AA%A8%EB%A6%AC_%EB%A7%B5<br>https://ko.wikipedia.org/wiki/%EB%A9%94%EB%AA%A8%EB%A6%AC_%EA%B3%84%EC%B8%B5_%EA%B5%AC%EC%A1%B0